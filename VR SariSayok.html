<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Trader Pro V21 (Tooltip Restored)</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --input-bg: #020617;
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            --accent: #8b5cf6;
            --buy: #10b981;
            --buy-bg: rgba(16, 185, 129, 0.05);
            --sell: #f43f5e;
            --sell-bg: rgba(244, 63, 94, 0.05);
            --border: #334155;
            --active-tab: #7c3aed;
            --tooltip-bg: #334155;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        /* 1. ìƒë‹¨ ëŒ€ì‹œë³´ë“œ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            text-align: center;
            align-items: center;
        }
        @media (max-width: 700px) { .dashboard-grid { grid-template-columns: 1fr; } }

        .dash-item { padding: 10px; position: relative; }
        .dash-label { font-size: 0.85rem; color: var(--text-sub); margin-bottom: 5px; display: flex; justify-content: center; align-items: center; gap: 5px; cursor: help; }
        .dash-value { font-size: 1.8rem; font-weight: 900; color: white; }
        .dash-sub { font-size: 0.75rem; color: #64748b; margin-top: 5px; }

        .v-box { border: 2px solid var(--accent); border-radius: 12px; background: rgba(139, 92, 246, 0.1); }
        .buy-box { border: 1px solid var(--buy); border-radius: 12px; background: var(--buy-bg); }
        .sell-box { border: 1px solid var(--sell); border-radius: 12px; background: var(--sell-bg); }

        /* 2. ì…ë ¥ í¼ */
        .input-section { margin-top: 10px; }
        .input-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        @media (max-width: 800px) { .input-grid { grid-template-columns: 1fr 1fr; } }

        .input-group { position: relative; }
        .input-group label { display: flex; align-items: center; gap: 5px; color: var(--text-sub); font-size: 0.75rem; margin-bottom: 5px; cursor: help; }
        .input-group input { 
            width: 100%; background: var(--input-bg); border: 1px solid var(--border); 
            color: white; padding: 12px; border-radius: 8px; text-align: right; font-weight: bold; font-size: 1rem;
        }
        .input-group input:focus { outline: none; border-color: var(--accent); }

        /* ======================== */
        /* [í•µì‹¬] V19 íˆ´íŒ ìŠ¤íƒ€ì¼ ë³µêµ¬ */
        /* ======================== */
        .help-icon {
            display: inline-flex; justify-content: center; align-items: center;
            width: 14px; height: 14px; background: #475569; color: white; border-radius: 50%;
            font-size: 0.6rem; 
        }
        
        /* ê¸°ë³¸ íˆ´íŒ (ì…ë ¥í¼ìš© - ìœ„ë¡œ ëœ¸) */
        .tooltip-text {
            visibility: hidden; width: 220px; background-color: var(--tooltip-bg);
            color: #f1f5f9; text-align: left; border-radius: 6px; padding: 10px;
            position: absolute; z-index: 50; 
            bottom: 135%; left: 50%; /* ìœ„ë¡œ ë„ì›€ */
            margin-left: -110px; opacity: 0; transition: opacity 0.2s;
            font-size: 0.75rem; line-height: 1.4; box-shadow: 0 4px 15px rgba(0,0,0,0.6);
            border: 1px solid #475569; font-weight: normal; pointer-events: none;
        }
        /* ê¸°ë³¸ íˆ´íŒ í™”ì‚´í‘œ (ì•„ë˜ìª½) */
        .tooltip-text::after {
            content: ""; position: absolute; top: 100%; left: 50%;
            margin-left: -5px; border-width: 5px; border-style: solid;
            border-color: var(--tooltip-bg) transparent transparent transparent;
        }

        /* [ìƒë‹¨ìš©] ì•„ë˜ë¡œ ëœ¨ëŠ” íˆ´íŒ (í™”ë©´ ì˜ë¦¼ ë°©ì§€) */
        .tooltip-text.bottom {
            bottom: auto; top: 135%; /* ì•„ë˜ë¡œ ë„ì›€ */
        }
        /* ì•„ë˜ë¡œ ëœ¨ëŠ” íˆ´íŒ í™”ì‚´í‘œ (ìœ„ìª½) */
        .tooltip-text.bottom::after {
            top: auto; bottom: 100%;
            border-color: transparent transparent var(--tooltip-bg) transparent;
        }

        /* í˜¸ë²„ ì‹œ í‘œì‹œ */
        .help-icon:hover + .tooltip-text, 
        .dash-label:hover .tooltip-text,
        .input-group label:hover .tooltip-text {
            visibility: visible; opacity: 1;
        }

        /* ëª¨ë“œ ë²„íŠ¼ */
        .mode-group { display: flex; gap: 5px; margin-bottom: 15px; background: var(--input-bg); padding: 4px; border-radius: 8px; }
        .mode-btn { flex: 1; background: transparent; border: none; color: var(--text-sub); padding: 8px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .mode-btn.active { background: var(--active-tab); color: white; }

        /* 3. LOC ì¢Œìš° ë¶„í•  */
        .split-container { display: flex; gap: 15px; margin-top: 10px; }
        @media (max-width: 768px) { .split-container { flex-direction: column-reverse; } }

        .half-panel { flex: 1; display: flex; flex-direction: column; }
        
        .panel-header { font-size: 1rem; font-weight: bold; padding: 10px; margin-bottom: 10px; border-radius: 8px; text-align: center; display: flex; justify-content: space-between; align-items: center; }
        .header-buy { background: var(--buy-bg); color: var(--buy); border: 1px solid var(--buy); }
        .header-sell { background: var(--sell-bg); color: var(--sell); border: 1px solid var(--sell); }

        .table-wrap { overflow-y: auto; max-height: 500px; border-radius: 8px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { position: sticky; top: 0; background: var(--card-bg); color: var(--text-sub); padding: 10px; border-bottom: 1px solid var(--border); z-index: 2; font-size: 0.8rem; }
        td { padding: 10px 8px; border-bottom: 1px solid #334155; text-align: center; font-variant-numeric: tabular-nums; }
        
        .price-cell { font-weight: bold; font-size: 1.05rem; }
        .qty-cell { color: var(--text-sub); font-size: 0.85rem; }

        .total-cash-info { grid-column: span 4; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; margin-top: 5px; }
        @media (max-width: 800px) { .total-cash-info { grid-column: span 2; } }

        /* ë§¤ë„ ê³µì‹ ë°•ìŠ¤ */
        .formula-box { margin-top: 15px; padding: 15px; background: rgba(244, 63, 94, 0.05); border: 1px dashed var(--sell); border-radius: 8px; font-size: 0.85rem; color: var(--text-sub); line-height: 1.6; }
        .formula-box strong { color: var(--sell); display: block; margin-bottom: 5px; font-size: 0.95rem; }
        .formula-code { background: #020617; padding: 8px; border-radius: 4px; font-family: monospace; color: #e2e8f0; display: block; margin: 5px 0; text-align: center; border: 1px solid #334155; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body>

<div class="container">
    
    <div class="card">
        <div class="dashboard-grid">
            <div class="dash-item buy-box">
                <div class="dash-label">
                    BAND LOW (ë§¤ìˆ˜ ì‹œì‘)
                    <span class="help-icon">?</span>
                    <span class="tooltip-text bottom">
                        ì´ ê°€ê²© ì´í•˜ë¡œ ë–¨ì–´ì§€ë©´ ë§¤ìˆ˜ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.<br>
                        (V2ì—ì„œ ë°´ë“œ% ë§Œí¼ ëº€ ê°€ê²©)
                    </span>
                </div>
                <div class="dash-value" style="color:var(--buy)" id="dispBandLow">$0.00</div>
            </div>
            <div class="dash-item v-box">
                <div class="dash-label">
                    NEXT TARGET (V2)
                    <span class="help-icon">?</span>
                    <span class="tooltip-text bottom">
                        ì´ë²ˆ 2ì£¼(1ì‚¬ì´í´) ë™ì•ˆ ëª©í‘œë¡œ í•˜ëŠ” ë‚´ ê³„ì¢Œì˜ ì´ ìì‚° ê°€ì¹˜ì…ë‹ˆë‹¤.<br>
                        (V1 + Poolì„±ì¥ë¶„ + ì ë¦½ê¸ˆ)
                    </span>
                </div>
                <div class="dash-value" id="dispV2">$0.00</div>
                <div class="dash-sub">V1 + (PoolÃ·G) Â± Flow</div>
            </div>
            <div class="dash-item sell-box">
                <div class="dash-label">
                    BAND HIGH (ë§¤ë„ ì‹œì‘)
                    <span class="help-icon">?</span>
                    <span class="tooltip-text bottom">
                        ì´ ê°€ê²© ì´ìƒìœ¼ë¡œ ì˜¤ë¥´ë©´ ë§¤ë„ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.<br>
                        (V2ì—ì„œ ë°´ë“œ% ë§Œí¼ ë”í•œ ê°€ê²©)
                    </span>
                </div>
                <div class="dash-value" style="color:var(--sell)" id="dispBandHigh">$0.00</div>
            </div>
        </div>
    </div>

    <div class="card input-section">
        <div class="mode-group">
            <button class="mode-btn active" onclick="setMode(75, this)">ì ë¦½ì‹(75%)</button>
            <button class="mode-btn" onclick="setMode(50, this)">ê±°ì¹˜ì‹(50%)</button>
            <button class="mode-btn" onclick="setMode(25, this)">ì¸ì¶œì‹(25%)</button>
            <button class="mode-btn" onclick="enableCustomInput(this)">ì§ì ‘ì„¤ì •</button>
        </div>

        <div class="input-grid">
            <div class="input-group">
                <label>ì§ì „ ëª©í‘œ V1 ($) <span class="help-icon">?</span><span class="tooltip-text">2ì£¼ ì „(ì§€ë‚œ ì‚¬ì´í´)ì˜ ëª©í‘œê°€ì…ë‹ˆë‹¤.<br>ì²˜ìŒì´ë¼ë©´ ì´ íˆ¬ìì›ê¸ˆì„ ë„£ìœ¼ì„¸ìš”.</span></label>
                <input type="number" id="v1" value="10000" step="0.01">
            </div>
            <div class="input-group">
                <label>ë³´ìœ  ìˆ˜ëŸ‰ (Qty) <span class="help-icon">?</span><span class="tooltip-text">í˜„ì¬ ê³„ì¢Œì— ìˆëŠ” ì£¼ì‹ ìˆ˜ëŸ‰ì…ë‹ˆë‹¤.</span></label>
                <input type="number" id="qty" value="100">
            </div>
            <div class="input-group">
                <label>Gê°’ (ê¸°ìš¸ê¸°) <span class="help-icon">?</span><span class="tooltip-text">ëª©í‘œ ì„±ì¥ ì†ë„ì…ë‹ˆë‹¤.<br>10: ë³´í†µ (ì ë¦½/ê±°ì¹˜)<br>20: ë³´ìˆ˜ì  (ì¸ì¶œì‹)</span></label>
                <input type="number" id="gVal" value="10">
            </div>
            <div class="input-group">
                <label>í—ˆìš© ë°´ë“œ (%) <span class="help-icon">?</span><span class="tooltip-text">ëª©í‘œê°€ ëŒ€ë¹„ ìœ„ì•„ë˜ë¡œ í—ˆìš©í•˜ëŠ” ë³€ë™í­ì…ë‹ˆë‹¤.<br>ë³´í†µ 15%ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</span></label>
                <input type="number" id="band" value="15">
            </div>

            <div class="input-group">
                <label style="color:#a5b4fc">Pool ($) - ì„±ì¥ë™ë ¥ <span class="help-icon">?</span><span class="tooltip-text">Vê°’ì„ ì„±ì¥ì‹œí‚¤ëŠ” ê¸°ì´ˆ ìì‚°(ì˜ˆìˆ˜ê¸ˆ)ì…ë‹ˆë‹¤.<br>ë³´í†µ ì‚¬ì´í´ ì‹œì‘ ì‹œì ì˜ í˜„ê¸ˆì…ë‹ˆë‹¤.</span></label>
                <input type="number" id="pool" value="5000" step="0.01" style="border-color:#a5b4fc">
            </div>
            <div class="input-group">
                <label style="color:#10b981">ì ë¦½/ì¸ì¶œ ($) - Flow <span class="help-icon">?</span><span class="tooltip-text">ì´ë²ˆì— ì¶”ê°€ë¡œ ë„£ì€ ëˆ(ì–‘ìˆ˜)ì´ë‚˜,<br>ìƒí™œë¹„ë¡œ ëº€ ëˆ(ìŒìˆ˜)ì„ ì…ë ¥í•˜ì„¸ìš”.</span></label>
                <input type="number" id="flow" value="0" step="0.01" style="border-color:#10b981">
            </div>
            
            <div class="input-group">
                <label>POOL í•œë„ (%) <span class="help-icon">?</span><span class="tooltip-text">í˜„ê¸ˆ ê³ ê°ˆì„ ë§‰ê¸° ìœ„í•´<br>ê°€ìš© í˜„ê¸ˆì˜ ì¼ë¶€ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</span></label>
                <input type="number" id="poolLimitPercent" value="75" readonly>
            </div>
            
            <div class="total-cash-info">
                <span style="color:#aaa">ğŸ’° ë§¤ìˆ˜ ê°€ìš© ê¸ˆì•¡ = (Pool + Flow) Ã— í•œë„%</span>
                <strong style="color:white; font-size:1.1rem;" id="limitAmt">$0.00</strong>
            </div>
        </div>
    </div>

    <div class="split-container">
        
        <div class="half-panel">
            <div class="panel-header header-buy">
                <span>ğŸ“‰ ë§¤ìˆ˜ ì˜ˆì•½ (Buy)</span>
                <span style="font-size:0.8rem; opacity:0.8">í•œë„ ì†Œì§„ ì‹œê¹Œì§€</span>
            </div>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th width="20%">ì°¨ìˆ˜</th>
                            <th width="30%">ì§€ì •ê°€ (LOC)</th>
                            <th width="25%">ìˆ˜ëŸ‰</th>
                            <th width="25%">ëˆ„ì ì•¡</th>
                        </tr>
                    </thead>
                    <tbody id="buyBody"></tbody>
                </table>
            </div>
        </div>

        <div class="half-panel">
            <div class="panel-header header-sell">
                <span>ğŸ“ˆ ë§¤ë„ ì˜ˆì•½ (Sell)</span>
                <span style="font-size:0.8rem; opacity:0.8">ìƒìœ„ 10í˜¸ê°€</span>
            </div>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th width="20%">ì°¨ìˆ˜</th>
                            <th width="30%">ì§€ì •ê°€ (LOC)</th>
                            <th width="25%">ìˆ˜ëŸ‰</th>
                            <th width="25%">ëˆ„ì ì•¡</th>
                        </tr>
                    </thead>
                    <tbody id="sellBody"></tbody>
                </table>
            </div>
            
            <div class="formula-box">
                <strong>ğŸ’¡ 11ë²ˆì§¸ ì´í›„ ë§¤ë„ ê³„ì‚°ë²•</strong>
                í‘œê°€ ë„ˆë¬´ ê¸¸ì–´ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ìƒìœ„ 10ê°œë§Œ í‘œì‹œë©ë‹ˆë‹¤.<br>
                ê·¸ ì´í›„ ë¬¼ëŸ‰ì€ ì•„ë˜ ê³µì‹ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ì˜ˆì•½í•˜ì„¸ìš”.
                <span class="formula-code">
                    ì§€ì •ê°€ = ë°´ë“œìƒë‹¨ê°€ Ã· (í˜„ì¬ìˆ˜ëŸ‰ - ëˆ„ì ë§¤ë„ìˆ˜)
                </span>
                <div style="margin-top:5px; font-size:0.8rem; color:#94a3b8;">
                    ì˜ˆ) 11ë²ˆì§¸ ë§¤ë„: <span id="exPrice" style="color:var(--sell); font-weight:bold;">$0.00</span> Ã· (ìˆ˜ëŸ‰ - 10)
                </div>
            </div>
        </div>

    </div>

</div>

<script>
    function formatNum(num) {
        return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function setMode(percent, btn) {
        const input = document.getElementById('poolLimitPercent');
        const gInput = document.getElementById('gVal');

        input.value = percent;
        input.readOnly = true;

        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');

        // Gê°’ ìë™ ë³€ê²½ (ì¸ì¶œì‹=20, ë‚˜ë¨¸ì§€=10)
        if (percent === 25) gInput.value = 20; 
        else gInput.value = 10;

        calc();
    }

    function enableCustomInput(btn) {
        const input = document.getElementById('poolLimitPercent');
        input.readOnly = false;
        input.focus();
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
    }

    function calc() {
        const v1 = parseFloat(document.getElementById('v1').value) || 0;
        const qty = parseFloat(document.getElementById('qty').value) || 0;
        const g = parseFloat(document.getElementById('gVal').value) || 10;
        const band = parseFloat(document.getElementById('band').value) || 15;
        
        const pool = parseFloat(document.getElementById('pool').value) || 0;
        const flow = parseFloat(document.getElementById('flow').value) || 0;
        const limitPercent = parseFloat(document.getElementById('poolLimitPercent').value) || 75;

        // V2 ê³„ì‚°
        const v2 = v1 + (pool / g) + flow;
        const bandLow = v2 * (1 - band/100);
        const bandHigh = v2 * (1 + band/100);

        document.getElementById('dispV2').innerText = `$${formatNum(v2)}`;
        document.getElementById('dispBandLow').innerText = `$${formatNum(bandLow)}`;
        document.getElementById('dispBandHigh').innerText = `$${formatNum(bandHigh)}`;
        
        // ì˜ˆì‹œ ê°€ê²© ì—…ë°ì´íŠ¸ (ë°´ë“œìƒë‹¨)
        document.getElementById('exPrice').innerText = `$${formatNum(bandHigh)}`;

        // ë§¤ìˆ˜ ê°€ìš© ê¸ˆì•¡
        const totalCash = pool + flow;
        const maxSpend = totalCash * (limitPercent / 100);
        document.getElementById('limitAmt').innerHTML = `$${formatNum(maxSpend)} <span style="font-size:0.8rem; color:#94a3b8">(Total $${formatNum(totalCash)})</span>`;

        // LOC ë§¤ìˆ˜ í…Œì´ë¸” (ì¢Œì¸¡)
        const buyBody = document.getElementById('buyBody');
        buyBody.innerHTML = '';
        
        let accumulatedCost = 0;
        let n = 0; 
        
        while(true) {
            const buyCount = n + 1;
            const denominator = qty + n; 
            const price = bandLow / denominator;
            const cost = price * 1; 

            if (accumulatedCost + cost > maxSpend) {
                if (n === 0) {
                     buyBody.innerHTML = `<tr><td colspan="4" style="padding:20px; color:#ef4444;">ê°€ìš© ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.</td></tr>`;
                } else {
                    buyBody.innerHTML += `<tr><td colspan="4" style="color:#ef4444; font-size:0.85rem; padding:10px;">â›” í•œë„ ë„ë‹¬ (ëˆ„ì  $${formatNum(accumulatedCost)})</td></tr>`;
                }
                break;
            }
            accumulatedCost += cost;

            buyBody.innerHTML += `
                <tr>
                    <td>${buyCount}ì°¨</td>
                    <td class="price-cell" style="color:var(--buy)">$${formatNum(price)}</td>
                    <td class="qty-cell">+${buyCount} <span style="font-size:0.75rem">(${denominator})</span></td>
                    <td style="color:#94a3b8">$${formatNum(accumulatedCost)}</td>
                </tr>
            `;

            n++;
            if(n > 200) break; // ì•ˆì „ì¥ì¹˜
        }

        // LOC ë§¤ë„ í…Œì´ë¸” (ìš°ì¸¡) - 10ê°œ ì œí•œ
        const sellBody = document.getElementById('sellBody');
        sellBody.innerHTML = '';

        const sellLimit = Math.min(qty, 10); // ìµœëŒ€ 10ê°œ

        for(let i=0; i < sellLimit; i++) {
            const sellCount = i + 1;
            const denominator = qty - i;
            
            if(denominator <= 0) break;
            
            const price = bandHigh / denominator;
            const totalAmount = price * sellCount;

            sellBody.innerHTML += `
                <tr>
                    <td>${sellCount}ì°¨</td>
                    <td class="price-cell" style="color:var(--sell)">$${formatNum(price)}</td>
                    <td class="qty-cell">-${sellCount} <span style="font-size:0.75rem">(${denominator})</span></td>
                    <td style="color:#94a3b8">$${formatNum(totalAmount)}</td>
                </tr>
            `;
        }
        
        if (qty === 0) {
             sellBody.innerHTML = `<tr><td colspan="4" style="padding:20px; color:#94a3b8;">ë³´ìœ  ì£¼ì‹ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        }
    }

    document.querySelectorAll('input').forEach(i => i.addEventListener('input', calc));
    window.onload = calc;

</script>
</body>
</html>